var WindgetsDesktop,WindgetsElement,WindgetsIcon,WindgetsPanel,WindgetsScreen;WindgetsDesktop=function(t){return WindgetsElement.call(this,t),this.showWindowShap=function(t){return this.htmlNode.setAttribute("data-window-snap",t)},this},WindgetsElement=function(t){return this.htmlNode=document.createElement("div"),this.htmlNode.className=t.htmlClass},WindgetsIcon=function(t){return WindgetsElement.call(this,t),this.htmlNode.setAttribute("data-item-name",t.windowData.title),this.activate=function(t){return this.htmlNode.classList[["remove","add"][+t]]("active"),this},function(){return this.htmlNode.listen("click",function(){return t.windgets.activateWindow(t.id,!1,!0)})}.call(this),this},WindgetsPanel=function(t){return WindgetsElement.call(this,t),this},WindgetsScreen=function(t){return WindgetsElement.call(this,t),this};var Windgets,WindgetsWindow,hasProp={}.hasOwnProperty,indexOf=[].indexOf;Windgets=function(t){var e,n,i;return i={screen:{constructor:WindgetsScreen,htmlClass:"windgets-screen js-windgets-screen",subs:{desktop:{constructor:WindgetsDesktop,htmlClass:"windgets-desktop js-windgets-desktop",subs:{windows:{constructor:WindgetsWindow,htmlClass:"windgets-window js-windgets-window",data:t.windowsData}}},panel:{constructor:WindgetsPanel,htmlClass:"windgets-panel js-windgets-panel",subs:{icons:{constructor:WindgetsIcon,htmlClass:"windgets-icon js-windgets-icon",data:t.windowsData}}}}}},n=[],e=function(t,n){var i,s,o;for(s in i={},n)hasProp.call(n,s)&&((o=n[s]).subs?(Object.assign(i[s]=new o.constructor({htmlClass:o.htmlClass}),e(i[s].htmlNode,o.subs)),t.appendChild(i[s].htmlNode)):i[s]=o.data.map(function(e,n){var i;return i=new o.constructor({windgets:this,id:n,htmlClass:o.htmlClass,windowData:e}),t.appendChild(i.htmlNode),i},this));return i}.bind(this),this.elements=e(t.container,i),this.activateWindow=function(t,e,i){return indexOf.call(n,t)>=0&&(i&&t===n.slice(-1)[0]?this.elements.screen.desktop.windows[t].activate(!1,e=!0):n.splice(n.indexOf(t),1)),e?t=n.slice(-1)[0]:n.push(t),this.elements.screen.desktop.windows.forEach(function(e,n){return e.activate(t===n)}),n.forEach(function(t,e){return this.elements.screen.desktop.windows[t].htmlNode.style.zIndex=e},this),this.activateIcon(t),this},this.activateIcon=function(t){return this.elements.screen.panel.icons.forEach(function(e,n){return e.activate(t===n)}),this},this},WindgetsWindow=function(t){var e,n,i,s,o,r,d,a,l,c,h;return WindgetsElement.call(this,t),this.htmlNode.innerHTML='<div class="windgets-window-head"><div class="windgets-window-icon js-windgets-window-button" data-state="tile" data-item-name="'+t.windowData.title+'"></div><div class="windgets-window-title js-windgets-window-mover">'+t.windowData.title+'</div><div class="windgets-window-button js-windgets-window-button" data-state="fullscreen"></div></div><div class="windgets-window-body">'+t.windowData.content+'</div><div class="windgets-window-resizer js-windgets-window-resizer"></div>',this.activate=function(t,e){return e?d("tile"):t&&"tile"===h()&&d(n()),this.htmlNode.classList[["remove","add"][+!(!e&&!t)]]("active"),this},s={defaultState:"tile",snapDistance:10,savedProps:{}},e=function(){return s.controls={btns:this.htmlNode.querySelectorAll(".js-windgets-window-button"),mover:this.htmlNode.querySelector(".js-windgets-window-mover"),resizer:this.htmlNode.querySelector(".js-windgets-window-resizer")}},o=function(t){var e,n;for(e in n=[],t)n.push(this.htmlNode.style[e]="number"==typeof t[e]?t[e]+"px":t[e]);return n}.bind(this),i=function(){return s.savedProps.rect=this.htmlNode.getBoundingClientRect()}.bind(this),n=function(){var e,n;return e=function(){var e,n;return n=(e=t.windgets.elements.screen.desktop.htmlNode.getBoundingClientRect()).width>e.height?{x:.4,y:.5}:{x:.6,y:.6},{width:e.width*n.x,height:e.height*n.y,left:Math.random()*e.width*(1-n.x),top:Math.random()*e.height*(1-n.y)}},o((null!=(n=s.savedProps)?n.rect:void 0)||(s.savedProps.rect=e())),"regular"},h=function(){return arguments.length?this.htmlNode.setAttribute("data-state",arguments[0]):this.htmlNode.getAttribute("data-state")}.bind(this),d=function(e){return"tile"===e&&(o(t.windgets.elements.screen.panel.icons[t.id].htmlNode.getBoundingClientRect()),t.windgets.activateWindow(t.id,!0)),h(h()!==e?e:n())}.bind(this),r=function(t){return this.htmlNode.classList[["remove","add"][+("move"===t||"resize"===t)]]("transform"),this.htmlNode.classList[["remove","add"][+("move"===t)]]("move")}.bind(this),a=function(){return this.htmlNode.listen("mousedown touchstart",function(){return t.windgets.activateWindow(t.id)})},l=function(){return s.controls.btns.listen("click",function(t){return d(t.target.getAttribute("data-state"))})},c=function(){return[s.controls.mover,s.controls.resizer].listen("mousedown touchstart",function(e){var n,a,l,c,u,w,m,v,g,f,p,b;return e.preventDefault(),m="mousedown"===e.type?{coords:e,moveEvt:"mousemove",stopEvt:"mouseup"}:{coords:e.touches[0],moveEvt:"touchmove",stopEvt:"touchend"},u=t.windgets.elements.screen.desktop.htmlNode.getBoundingClientRect(),p=this.htmlNode.getBoundingClientRect(),c={x:m.coords.clientX,y:m.coords.clientY},b={left:p.left-u.left,top:p.top-u.top},n=e.target===s.controls.resizer?"resize":"move",w={move:!0,resize:!0},a=null,l=function(e){var i;if(i="mousemove"===e.type?e:e.touches[0],"move"===n)return t.windgets.elements.screen.desktop.showWindowShap(a=(i.clientY<u.top+s.snapDistance?"fullscreen":i.clientY>u.bottom-s.snapDistance&&"tile")||i.clientX<u.left+s.snapDistance&&"left"||i.clientX>u.right-s.snapDistance&&"right")}.bind(this),g="resize"===n?null:l,f=function(t){var e,i,a;if(i={x:(e="mousemove"===t.type?t:t.touches[0]).clientX-c.x,y:e.clientY-c.y},o("resize"===n?{width:p.width+i.x,height:p.height+i.y}:{left:b.left+i.x,top:b.top+i.y}),a=function(){var t;return t=s.savedProps.rect.width/p.width,e.clientX*(1-t)-u.left+p.left*t},w[n]&&(w[n]=!1,r(n),"move"===n&&"regular"!==h()))return o({left:b.left=a()}),d("regular")}.bind(this),v=function(){return window.listen(m.moveEvt,[f,g],!0).listen(m.stopEvt,v,!0),r(!1),a?(d(a),t.windgets.elements.screen.desktop.showWindowShap(a=null)):"regular"===h()?i():void 0}.bind(this),window.listen(m.moveEvt,[f,g]).listen(m.stopEvt,v)}.bind(this))},h(s.defaultState),e.call(this),a.call(this),l(),c.call(this),this};hasProp={}.hasOwnProperty;Object.prototype.convert=function(t,e){var n,i,s,o;switch(o=this.valueOf(),t){case"array":switch(s=[],typeof o){case"object":if(o.length)s=this;else if(null!=e?e.recursive:void 0)for(i in o)hasProp.call(o,i)&&(n=o[i],s.push(n.convert("array",!0)));else s=[o];break;case"string":(null!=e?e.separator:void 0)&&(s=o.split(e.separator));break;default:s=[o]}}return s},Object.prototype.listen=function(t,e,n){var i,s,o,r,d,a,l,c,h,u;for(s=this.convert("array"),t=t.convert("array",{separator:/\s/g}),e=e.convert("array"),d=0,c=s.length;d<c;d++)for(i=s[d],a=0,h=t.length;a<h;a++)for(o=t[a],l=0,u=e.length;l<u;l++)r=e[l],i[["removeEventListener","addEventListener"][+!n]](o,r);return this};